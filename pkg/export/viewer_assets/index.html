<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Beads Viewer</title>

  <!-- Early theme detection - MUST be first to prevent flash -->
  <script>
    (function() {
      const stored = localStorage.getItem('darkMode');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      // Use stored preference, or fall back to system preference
      if (stored === 'true' || (stored === null && prefersDark)) {
        document.documentElement.classList.add('dark');
      }
    })();
  </script>

  <!-- Security: Content Security Policy -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-eval' 'unsafe-inline' https://cdn.jsdelivr.net https://unpkg.com https://d3js.org;
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
    font-src 'self' https://fonts.gstatic.com;
    img-src 'self' data: blob:;
    connect-src 'self';
    worker-src 'self' blob:;
  ">

  <!-- Mermaid container styling -->
  <style>
    .mermaid-container { min-height: 150px; }
  </style>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono&display=swap" rel="stylesheet">

  <!-- Tailwind CSS (bundled locally for COEP compatibility) -->
  <script src="vendor/tailwindcss.js"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
            mono: ['JetBrains Mono', 'monospace'],
          },
          colors: {
            beads: {
              50: '#f0f9ff',
              100: '#e0f2fe',
              200: '#bae6fd',
              300: '#7dd3fc',
              400: '#38bdf8',
              500: '#0ea5e9',
              600: '#0284c7',
              700: '#0369a1',
              800: '#075985',
              900: '#0c4a6e',
            }
          }
        }
      }
    }
  </script>

  <!-- Custom styles -->
  <link rel="stylesheet" href="styles.css">

  <style>
    [x-cloak] { display: none !important; }

    /* Premium loading animation */
    .spinner {
      width: 48px;
      height: 48px;
      border: 3px solid transparent;
      border-top: 3px solid #0ea5e9;
      border-right: 3px solid #0ea5e9;
      border-radius: 50%;
      animation: spin 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55) infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Pulse animation for loading text */
    @keyframes pulse-subtle {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .animate-pulse-subtle {
      animation: pulse-subtle 2s ease-in-out infinite;
    }

    /* Smooth fade in for content */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in {
      animation: fadeIn 0.4s ease-out forwards;
    }

    /* Stagger animation for lists */
    .stagger-item { opacity: 0; animation: fadeIn 0.3s ease-out forwards; }
    .stagger-item:nth-child(1) { animation-delay: 0.05s; }
    .stagger-item:nth-child(2) { animation-delay: 0.1s; }
    .stagger-item:nth-child(3) { animation-delay: 0.15s; }
    .stagger-item:nth-child(4) { animation-delay: 0.2s; }
    .stagger-item:nth-child(5) { animation-delay: 0.25s; }

    /* Status badges - raw CSS fallback for when Tailwind fails */
    .status-open { background-color: #dbeafe; color: #1e40af; }
    .status-in_progress { background-color: #fef3c7; color: #92400e; }
    .status-blocked { background-color: #fee2e2; color: #991b1b; }
    .status-closed { background-color: #dcfce7; color: #166534; }
    .dark .status-open { background-color: #1e3a8a; color: #bfdbfe; }
    .dark .status-in_progress { background-color: #78350f; color: #fef3c7; }
    .dark .status-blocked { background-color: #7f1d1d; color: #fecaca; }
    .dark .status-closed { background-color: #14532d; color: #bbf7d0; }

    /* Priority indicators - raw CSS fallback */
    .priority-0 { border-left: 4px solid #ef4444; }
    .priority-1 { border-left: 4px solid #f97316; }
    .priority-2 { border-left: 4px solid #3b82f6; }
    .priority-3 { border-left: 4px solid #9ca3af; }
    .priority-4 { border-left: 4px solid #d1d5db; }

    /* Filter panel: always show on md+ screens */
    @media (min-width: 768px) {
      .filter-content { display: block !important; }
    }
  </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen">
  <!-- COOP/COEP check for SharedArrayBuffer (required for sql.js WASM) -->
  <script>
    // Check if we need the service worker for cross-origin isolation
    if (!crossOriginIsolated && 'serviceWorker' in navigator) {
      // Register COI service worker for GitHub Pages
      navigator.serviceWorker.register('./coi-serviceworker.js').then(() => {
        console.log('COI Service Worker registered, reloading for isolation...');
        // Small delay then reload to apply headers
        setTimeout(() => window.location.reload(), 100);
      }).catch(err => {
        console.warn('COI Service Worker registration failed:', err);
      });
    }
  </script>

  <!-- Alpine.js app -->
  <div x-data="beadsApp()" x-init="init()" x-cloak>
    <!-- Navigation header -->
    <header class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
          <!-- Logo and title -->
          <div class="flex items-center space-x-3">
            <div class="w-8 h-8 bg-beads-500 rounded-lg flex items-center justify-center">
              <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
              </svg>
            </div>
            <h1 class="text-lg sm:text-xl font-semibold">Beads Viewer</h1>
          </div>

          <!-- Desktop Navigation tabs (hidden on mobile) -->
          <nav class="hidden md:flex space-x-1">
            <a href="#/"
               @click.prevent="window.location.hash = '#/'"
               :class="view === 'dashboard' ? 'bg-beads-100 text-beads-700 dark:bg-beads-900 dark:text-beads-200' : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700'"
               class="px-4 py-2 rounded-lg text-sm font-medium transition-colors cursor-pointer">
              Dashboard
            </a>
            <a href="#/issues"
               @click.prevent="window.location.hash = '#/issues'"
               :class="view === 'issues' ? 'bg-beads-100 text-beads-700 dark:bg-beads-900 dark:text-beads-200' : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700'"
               class="px-4 py-2 rounded-lg text-sm font-medium transition-colors cursor-pointer">
              Issues
            </a>
            <a href="#/insights"
               @click.prevent="window.location.hash = '#/insights'"
               :class="view === 'insights' ? 'bg-beads-100 text-beads-700 dark:bg-beads-900 dark:text-beads-200' : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700'"
               class="px-4 py-2 rounded-lg text-sm font-medium transition-colors cursor-pointer">
              Insights
            </a>
            <a href="#/graph"
               @click.prevent="window.location.hash = '#/graph'"
               :class="view === 'graph' ? 'bg-beads-100 text-beads-700 dark:bg-beads-900 dark:text-beads-200' : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700'"
               class="px-4 py-2 rounded-lg text-sm font-medium transition-colors cursor-pointer">
              Graph
            </a>
          </nav>

          <!-- Actions -->
          <div class="flex items-center space-x-2 sm:space-x-3">
            <!-- Search (hidden on mobile, shown as icon) -->
            <div class="relative hidden sm:block">
              <input type="text"
                     x-model="searchQuery"
                     @input.debounce.300ms="search()"
                     placeholder="Search issues..."
                     class="w-40 lg:w-64 pl-10 pr-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm focus:ring-2 focus:ring-beads-500 focus:border-transparent">
              <svg class="absolute left-3 top-2.5 w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
              </svg>
            </div>

            <!-- Mobile search button (shows on mobile) -->
            <button @click="mobileSearchOpen = !mobileSearchOpen" class="sm:hidden p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
              </svg>
            </button>

            <!-- Dark mode toggle - Premium animated -->
            <button @click="toggleDarkMode()"
                    class="relative p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
                    title="Toggle dark mode">
              <div class="relative w-5 h-5">
                <svg x-show="!darkMode"
                     x-transition:enter="transition ease-out duration-200"
                     x-transition:enter-start="opacity-0 rotate-90 scale-50"
                     x-transition:enter-end="opacity-100 rotate-0 scale-100"
                     x-transition:leave="transition ease-in duration-150"
                     x-transition:leave-start="opacity-100 rotate-0 scale-100"
                     x-transition:leave-end="opacity-0 -rotate-90 scale-50"
                     class="w-5 h-5 absolute inset-0 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
                </svg>
                <svg x-show="darkMode"
                     x-transition:enter="transition ease-out duration-200"
                     x-transition:enter-start="opacity-0 -rotate-90 scale-50"
                     x-transition:enter-end="opacity-100 rotate-0 scale-100"
                     x-transition:leave="transition ease-in duration-150"
                     x-transition:leave-start="opacity-100 rotate-0 scale-100"
                     x-transition:leave-end="opacity-0 rotate-90 scale-50"
                     class="w-5 h-5 absolute inset-0 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
                </svg>
              </div>
            </button>

            <!-- Mobile menu button (hamburger) -->
            <button @click="mobileMenuOpen = !mobileMenuOpen" class="md:hidden p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
              <svg x-show="!mobileMenuOpen" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
              </svg>
              <svg x-show="mobileMenuOpen" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
              </svg>
            </button>
          </div>
        </div>
      </div>

      <!-- Mobile search bar (expandable) -->
      <div x-show="mobileSearchOpen" x-transition class="sm:hidden px-4 pb-3">
        <div class="relative">
          <input type="text"
                 x-model="searchQuery"
                 @input.debounce.300ms="search()"
                 placeholder="Search issues..."
                 class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm focus:ring-2 focus:ring-beads-500 focus:border-transparent">
          <svg class="absolute left-3 top-2.5 w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
          </svg>
        </div>
      </div>

      <!-- Mobile navigation menu -->
      <nav x-show="mobileMenuOpen" x-transition class="md:hidden border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900">
        <div class="px-4 py-3 space-y-1">
          <a href="#/"
             @click.prevent="window.location.hash = '#/'; mobileMenuOpen = false"
             :class="view === 'dashboard' ? 'bg-beads-100 text-beads-700 dark:bg-beads-900 dark:text-beads-200' : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800'"
             class="block px-4 py-3 rounded-lg text-base font-medium transition-colors">
            Dashboard
          </a>
          <a href="#/issues"
             @click.prevent="window.location.hash = '#/issues'; mobileMenuOpen = false"
             :class="view === 'issues' ? 'bg-beads-100 text-beads-700 dark:bg-beads-900 dark:text-beads-200' : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800'"
             class="block px-4 py-3 rounded-lg text-base font-medium transition-colors">
            Issues
          </a>
          <a href="#/insights"
             @click.prevent="window.location.hash = '#/insights'; mobileMenuOpen = false"
             :class="view === 'insights' ? 'bg-beads-100 text-beads-700 dark:bg-beads-900 dark:text-beads-200' : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800'"
             class="block px-4 py-3 rounded-lg text-base font-medium transition-colors">
            Insights
          </a>
          <a href="#/graph"
             @click.prevent="window.location.hash = '#/graph'; mobileMenuOpen = false"
             :class="view === 'graph' ? 'bg-beads-100 text-beads-700 dark:bg-beads-900 dark:text-beads-200' : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800'"
             class="block px-4 py-3 rounded-lg text-base font-medium transition-colors">
            Graph
          </a>
        </div>
      </nav>
    </header>

    <!-- WASM Fallback Mode Banner -->
    <div x-show="wasmStatus.fallbackMode && !loading"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0 -translate-y-2"
         x-transition:enter-end="opacity-100 translate-y-0"
         class="bg-yellow-50 dark:bg-yellow-900/30 border-b border-yellow-200 dark:border-yellow-800">
      <div class="max-w-7xl mx-auto px-4 py-2 flex items-center justify-between">
        <div class="flex items-center space-x-2">
          <svg class="w-4 h-4 text-yellow-600 dark:text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
          </svg>
          <span class="text-sm text-yellow-800 dark:text-yellow-200">
            <strong>Fallback Mode:</strong> Live graph calculations unavailable. Using pre-computed metrics.
          </span>
        </div>
        <button @click="showDiagnostics = true" class="text-xs text-yellow-700 dark:text-yellow-300 hover:underline">
          Details
        </button>
      </div>
    </div>

    <!-- Loading state - Premium branded experience -->
    <div x-show="loading" class="flex flex-col items-center justify-center min-h-[70vh]">
      <div class="relative">
        <div class="spinner mb-6"></div>
        <div class="absolute inset-0 flex items-center justify-center">
          <svg class="w-5 h-5 text-beads-600 dark:text-beads-400" fill="currentColor" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="3"/>
          </svg>
        </div>
      </div>
      <div class="text-center">
        <p class="text-lg font-medium text-gray-700 dark:text-gray-300 animate-pulse-subtle" x-text="loadingMessage">Loading database...</p>
        <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">Preparing your project insights</p>
      </div>
    </div>

    <!-- Error state - Premium design -->
    <div x-show="error" class="flex items-center justify-center min-h-[60vh] px-4">
      <div class="max-w-md w-full">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 p-8 text-center">
          <div class="w-16 h-16 mx-auto mb-6 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center">
            <svg class="w-8 h-8 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
          </div>
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2">Unable to load data</h3>
          <p class="text-gray-600 dark:text-gray-400 mb-6" x-text="error"></p>
          <button @click="init()"
                  class="inline-flex items-center gap-2 px-6 py-3 bg-beads-600 text-white rounded-xl hover:bg-beads-700 transition-colors font-medium shadow-lg shadow-beads-500/20 hover:shadow-beads-500/30">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
            </svg>
            Try Again
          </button>
        </div>
      </div>
    </div>

    <!-- Main content -->
    <main x-show="!loading && !error" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <!-- Dashboard view -->
      <div x-show="view === 'dashboard'">
        <!-- Stats cards - 5 columns (clickable to filter) -->
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-8">
          <div @click="filters.status = ['open']; view = 'issues'; applyFilters()"
               class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-5 cursor-pointer hover:border-blue-400 dark:hover:border-blue-500 hover:shadow-md transition-all group">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-gray-500 dark:text-gray-400 group-hover:text-blue-600 dark:group-hover:text-blue-400">Open</p>
                <p class="text-2xl font-bold mt-1" x-text="stats.open || 0"></p>
              </div>
              <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
                <svg class="w-5 h-5 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                </svg>
              </div>
            </div>
          </div>

          <div @click="filters.status = ['in_progress']; view = 'issues'; applyFilters()"
               class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-5 cursor-pointer hover:border-yellow-400 dark:hover:border-yellow-500 hover:shadow-md transition-all group">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-gray-500 dark:text-gray-400 group-hover:text-yellow-600 dark:group-hover:text-yellow-400">In Progress</p>
                <p class="text-2xl font-bold mt-1" x-text="stats.in_progress || 0"></p>
              </div>
              <div class="w-10 h-10 bg-yellow-100 dark:bg-yellow-900 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
                <svg class="w-5 h-5 text-yellow-600 dark:text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
              </div>
            </div>
          </div>

          <div @click="filters.hasBlockers = true; filters.status = ['open', 'in_progress']; view = 'issues'; applyFilters()"
               class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-5 cursor-pointer hover:border-red-400 dark:hover:border-red-500 hover:shadow-md transition-all group">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-gray-500 dark:text-gray-400 group-hover:text-red-600 dark:group-hover:text-red-400">Blocked</p>
                <p class="text-2xl font-bold mt-1" x-text="stats.blocked || 0"></p>
              </div>
              <div class="w-10 h-10 bg-red-100 dark:bg-red-900 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
                <svg class="w-5 h-5 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"/>
                </svg>
              </div>
            </div>
          </div>

          <div @click="filters.hasBlockers = false; filters.status = ['open']; view = 'issues'; applyFilters()"
               class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-5 cursor-pointer hover:border-emerald-400 dark:hover:border-emerald-500 hover:shadow-md transition-all group">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-gray-500 dark:text-gray-400 group-hover:text-emerald-600 dark:group-hover:text-emerald-400">Actionable</p>
                <p class="text-2xl font-bold mt-1 text-emerald-600 dark:text-emerald-400" x-text="stats.actionable || 0"></p>
              </div>
              <div class="w-10 h-10 bg-emerald-100 dark:bg-emerald-900 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
                <svg class="w-5 h-5 text-emerald-600 dark:text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                </svg>
              </div>
            </div>
          </div>

          <div @click="filters.status = ['closed']; view = 'issues'; applyFilters()"
               class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-5 cursor-pointer hover:border-green-400 dark:hover:border-green-500 hover:shadow-md transition-all group">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-gray-500 dark:text-gray-400 group-hover:text-green-600 dark:group-hover:text-green-400">Closed</p>
                <p class="text-2xl font-bold mt-1" x-text="stats.closed || 0"></p>
              </div>
              <div class="w-10 h-10 bg-green-100 dark:bg-green-900 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
                <svg class="w-5 h-5 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
              </div>
            </div>
          </div>
        </div>

        <!-- Explore Graph CTA - Hero Card -->
        <div @click="view = 'graph'"
             class="mb-8 relative overflow-hidden bg-gradient-to-br from-beads-600 via-beads-700 to-beads-800 dark:from-beads-700 dark:via-beads-800 dark:to-beads-900 rounded-2xl shadow-xl cursor-pointer group hover:shadow-2xl hover:scale-[1.01] transition-all duration-300">
          <div class="absolute inset-0 opacity-10">
            <svg class="w-full h-full" viewBox="0 0 400 120" preserveAspectRatio="xMidYMid slice">
              <defs>
                <pattern id="graph-pattern" patternUnits="userSpaceOnUse" width="60" height="60">
                  <circle cx="30" cy="30" r="3" fill="currentColor"/>
                  <line x1="30" y1="30" x2="60" y2="0" stroke="currentColor" stroke-width="0.5"/>
                  <line x1="30" y1="30" x2="0" y2="60" stroke="currentColor" stroke-width="0.5"/>
                  <line x1="30" y1="30" x2="60" y2="60" stroke="currentColor" stroke-width="0.5"/>
                </pattern>
              </defs>
              <rect width="100%" height="100%" fill="url(#graph-pattern)" class="text-white"/>
            </svg>
          </div>
          <div class="relative px-6 py-5 flex items-center justify-between">
            <div class="flex items-center gap-4">
              <div class="w-12 h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/>
                </svg>
              </div>
              <div>
                <h2 class="text-lg font-bold text-white">Explore Dependency Graph</h2>
                <p class="text-sm text-white/80">Visualize how issues connect and find optimal paths to completion</p>
              </div>
            </div>
            <div class="flex items-center gap-2 text-white">
              <span class="hidden sm:inline text-sm font-medium">Launch Graph View</span>
              <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
              </svg>
            </div>
          </div>
        </div>

        <!-- Quick Wins and Blockers to Clear -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
          <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-lg font-semibold flex items-center">
                <svg class="w-5 h-5 text-emerald-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                </svg>
                Quick Wins
              </h2>
              <span class="text-xs text-gray-500 dark:text-gray-400">Ready to start, max unblock</span>
            </div>
            <div class="space-y-2">
              <template x-for="issue in quickWins" :key="issue.id">
                <div class="p-3 bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-200 dark:border-emerald-800 rounded-lg cursor-pointer hover:bg-emerald-100 dark:hover:bg-emerald-900/30 transition-colors"
                     @click="showIssue(issue.id)">
                  <div class="flex items-start justify-between">
                    <div class="flex-1 min-w-0">
                      <span class="text-xs font-mono text-emerald-600 dark:text-emerald-400" x-text="issue.id"></span>
                      <h3 class="font-medium truncate" x-text="issue.title"></h3>
                    </div>
                    <span x-show="issue.blocks_count" class="ml-2 px-2 py-0.5 text-xs font-medium bg-emerald-200 dark:bg-emerald-800 text-emerald-800 dark:text-emerald-200 rounded">
                      unblocks <span x-text="issue.blocks_count"></span>
                    </span>
                  </div>
                </div>
              </template>
              <div x-show="quickWins.length === 0" class="text-center py-6">
                <div class="w-10 h-10 mx-auto mb-3 bg-emerald-100 dark:bg-emerald-900/30 rounded-full flex items-center justify-center">
                  <svg class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                  </svg>
                </div>
                <p class="text-gray-500 dark:text-gray-400 text-sm">All caught up!</p>
                <p class="text-gray-400 dark:text-gray-500 text-xs mt-1">No quick wins at the moment</p>
              </div>
            </div>
          </div>

          <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-lg font-semibold flex items-center">
                <svg class="w-5 h-5 text-orange-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                </svg>
                Blockers to Clear
              </h2>
              <span class="text-xs text-gray-500 dark:text-gray-400">Blocking the most issues</span>
            </div>
            <div class="space-y-2">
              <template x-for="issue in blockersToClose" :key="issue.id">
                <div class="p-3 bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-lg cursor-pointer hover:bg-orange-100 dark:hover:bg-orange-900/30 transition-colors"
                     @click="showIssue(issue.id)">
                  <div class="flex items-start justify-between">
                    <div class="flex-1 min-w-0">
                      <span class="text-xs font-mono text-orange-600 dark:text-orange-400" x-text="issue.id"></span>
                      <h3 class="font-medium truncate" x-text="issue.title"></h3>
                    </div>
                    <span class="ml-2 px-2 py-0.5 text-xs font-medium bg-orange-200 dark:bg-orange-800 text-orange-800 dark:text-orange-200 rounded">
                      blocks <span x-text="issue.blocks_count"></span>
                    </span>
                  </div>
                </div>
              </template>
              <div x-show="blockersToClose.length === 0" class="text-center py-6">
                <div class="w-10 h-10 mx-auto mb-3 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center">
                  <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                  </svg>
                </div>
                <p class="text-gray-500 dark:text-gray-400 text-sm">No blocking issues</p>
                <p class="text-gray-400 dark:text-gray-500 text-xs mt-1">Your project flow is clear</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Distribution charts and Top picks -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
          <!-- Distribution by Type -->
          <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
            <h2 class="text-lg font-semibold mb-4">By Type</h2>
            <div class="space-y-3">
              <template x-for="item in distributionByType" :key="item.type">
                <div class="flex items-center">
                  <span class="w-20 text-sm text-gray-600 dark:text-gray-400 capitalize" x-text="item.type || 'unknown'"></span>
                  <div class="flex-1 mx-3 h-4 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                    <div class="h-full bg-beads-500 rounded-full transition-all duration-500"
                         :style="'width: ' + (stats.total ? Math.round(item.count / (stats.open + stats.in_progress) * 100) : 0) + '%'"></div>
                  </div>
                  <span class="w-8 text-sm font-medium text-right" x-text="item.count"></span>
                </div>
              </template>
              <p x-show="distributionByType.length === 0" class="text-gray-500 dark:text-gray-400 text-center py-4 text-sm">No data</p>
            </div>
          </div>

          <!-- Distribution by Priority -->
          <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
            <h2 class="text-lg font-semibold mb-4">By Priority</h2>
            <div class="space-y-3">
              <template x-for="item in distributionByPriority" :key="item.priority">
                <div class="flex items-center">
                  <span class="w-12 text-sm font-medium"
                        :class="{
                          'text-red-600 dark:text-red-400': item.priority === 0,
                          'text-orange-600 dark:text-orange-400': item.priority === 1,
                          'text-blue-600 dark:text-blue-400': item.priority === 2,
                          'text-gray-600 dark:text-gray-400': item.priority >= 3
                        }"
                        x-text="'P' + item.priority"></span>
                  <div class="flex-1 mx-3 h-4 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                    <div class="h-full rounded-full transition-all duration-500"
                         :class="{
                           'bg-red-500': item.priority === 0,
                           'bg-orange-500': item.priority === 1,
                           'bg-blue-500': item.priority === 2,
                           'bg-gray-400': item.priority >= 3
                         }"
                         :style="'width: ' + (stats.total ? Math.round(item.count / (stats.open + stats.in_progress) * 100) : 0) + '%'"></div>
                  </div>
                  <span class="w-8 text-sm font-medium text-right" x-text="item.count"></span>
                </div>
              </template>
              <p x-show="distributionByPriority.length === 0" class="text-gray-500 dark:text-gray-400 text-center py-4 text-sm">No data</p>
            </div>
          </div>

          <!-- Top Picks -->
          <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
            <h2 class="text-lg font-semibold mb-4">Top Picks</h2>
            <div class="space-y-2">
              <template x-for="issue in topPicks" :key="issue.id">
                <div class="p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
                     :class="'priority-' + issue.priority"
                     @click="showIssue(issue.id)">
                  <div class="flex items-start justify-between">
                    <div class="flex-1 min-w-0">
                      <span class="text-xs font-mono text-gray-500 dark:text-gray-400" x-text="issue.id"></span>
                      <h3 class="font-medium truncate text-sm" x-text="issue.title"></h3>
                    </div>
                    <span class="px-2 py-0.5 text-xs font-medium rounded-full ml-2"
                          :class="'status-' + issue.status"
                          x-text="issue.status"></span>
                  </div>
                </div>
              </template>
              <div x-show="topPicks.length === 0" class="text-center py-8">
                <div class="w-12 h-12 mx-auto mb-3 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center">
                  <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                  </svg>
                </div>
                <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">No issues to display</p>
                <p class="text-gray-400 dark:text-gray-500 text-xs mt-1">Start by creating some beads</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Charts Dashboard (bv-wb6h) -->
        <div x-data="{ chartsExpanded: false }" class="mb-8">
          <button @click="chartsExpanded = !chartsExpanded"
                  class="w-full flex items-center justify-between bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors">
            <div class="flex items-center space-x-3">
              <svg class="w-5 h-5 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
              </svg>
              <span class="font-semibold">Interactive Charts Dashboard</span>
            </div>
            <svg class="w-5 h-5 text-gray-500 transition-transform" :class="{ 'rotate-180': chartsExpanded }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </button>

          <div x-show="chartsExpanded" x-transition class="mt-4 grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Burndown Chart -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
              <h3 class="text-lg font-semibold mb-4 flex items-center">
                <svg class="w-5 h-5 text-green-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                </svg>
                Progress Over Time
              </h3>
              <div class="h-64">
                <canvas id="burndown-chart"></canvas>
              </div>
            </div>

            <!-- Priority Distribution -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
              <h3 class="text-lg font-semibold mb-4 flex items-center">
                <svg class="w-5 h-5 text-orange-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"/>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"/>
                </svg>
                Priority Distribution
              </h3>
              <div class="h-64">
                <canvas id="priority-chart"></canvas>
              </div>
            </div>

            <!-- Type Breakdown -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
              <h3 class="text-lg font-semibold mb-4 flex items-center">
                <svg class="w-5 h-5 text-blue-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"/>
                </svg>
                Issues by Type
              </h3>
              <div class="h-64">
                <canvas id="type-chart"></canvas>
              </div>
            </div>

            <!-- Label Dependency Heatmap -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
              <h3 class="text-lg font-semibold mb-4 flex items-center">
                <svg class="w-5 h-5 text-pink-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"/>
                </svg>
                Label Dependency Heatmap
              </h3>
              <div id="heatmap-container" class="h-64 overflow-auto flex items-center justify-center">
                <p class="text-gray-500 dark:text-gray-400 text-sm">Expand to load heatmap</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Recent Activity -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
          <h2 class="text-lg font-semibold mb-4">Recent Activity</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
            <template x-for="issue in recentIssues" :key="issue.id">
              <div class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700/50 cursor-pointer transition-colors"
                   @click="showIssue(issue.id)">
                <span class="px-2 py-1 text-xs font-medium rounded-full shrink-0"
                      :class="'status-' + issue.status"
                      x-text="issue.status"></span>
                <div class="flex-1 min-w-0">
                  <p class="font-medium truncate text-sm" x-text="issue.title"></p>
                  <p class="text-xs text-gray-500 dark:text-gray-400" x-text="formatDate(issue.updated_at)"></p>
                </div>
              </div>
            </template>
            <p x-show="recentIssues.length === 0" class="text-gray-500 dark:text-gray-400 text-center py-4 col-span-full">No recent activity</p>
          </div>
        </div>
      </div>

      <!-- Issues list view -->
      <div x-show="view === 'issues'">
        <!-- Filters Panel -->
        <div class="mb-6 bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4">
          <!-- Filter header with toggle for mobile -->
          <div class="flex items-center justify-between md:mb-4"
               :class="{ 'mb-4': filtersExpanded }">
            <button @click="filtersExpanded = !filtersExpanded" class="md:hidden flex items-center space-x-2">
              <svg class="w-4 h-4 transition-transform" :class="{ 'rotate-90': filtersExpanded }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
              </svg>
              <h3 class="text-sm font-medium text-gray-700 dark:text-gray-300">Filters</h3>
              <span x-show="hasActiveFilters" class="px-2 py-0.5 bg-beads-100 dark:bg-beads-900 text-beads-700 dark:text-beads-200 text-xs rounded-full">
                Active
              </span>
            </button>
            <div class="hidden md:flex items-center space-x-2">
              <h3 class="text-sm font-medium text-gray-700 dark:text-gray-300">Filters</h3>
              <span x-show="hasActiveFilters" class="px-2 py-0.5 bg-beads-100 dark:bg-beads-900 text-beads-700 dark:text-beads-200 text-xs rounded-full">
                Active
              </span>
            </div>
            <button x-show="hasActiveFilters" @click="clearFilters()"
                    class="text-sm text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
              Clear all
            </button>
          </div>

          <!-- Filter rows (collapsible on mobile, always shown on desktop) -->
          <div class="space-y-4 mt-4 filter-content" x-show="filtersExpanded" x-transition>
            <!-- Status filter (multi-select chips) -->
            <div>
              <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-2">Status</label>
              <div class="flex flex-wrap gap-2">
                <template x-for="status in filterOptions.statuses" :key="status">
                  <button @click="toggleFilter('status', status)"
                          :class="isFilterSelected('status', status) ? 'bg-beads-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'"
                          class="px-3 py-1.5 rounded-full text-xs font-medium transition-colors">
                    <span x-text="status.replace('_', ' ')"></span>
                  </button>
                </template>
              </div>
            </div>

            <!-- Type filter (multi-select chips) -->
            <div>
              <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-2">Type</label>
              <div class="flex flex-wrap gap-2">
                <template x-for="type in filterOptions.types" :key="type">
                  <button @click="toggleFilter('type', type)"
                          :class="isFilterSelected('type', type) ? 'bg-beads-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'"
                          class="px-3 py-1.5 rounded-full text-xs font-medium transition-colors capitalize">
                    <span x-text="type"></span>
                  </button>
                </template>
              </div>
            </div>

            <!-- Priority filter (multi-select chips) -->
            <div>
              <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-2">Priority</label>
              <div class="flex flex-wrap gap-2">
                <template x-for="priority in filterOptions.priorities" :key="priority">
                  <button @click="toggleFilter('priority', priority)"
                          :class="isFilterSelected('priority', priority) ? 'bg-beads-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'"
                          class="px-3 py-1.5 rounded-full text-xs font-medium transition-colors">
                    <span x-text="'P' + priority"></span>
                  </button>
                </template>
              </div>
            </div>

            <!-- Second row: Assignee, Blocked/Blocking toggles, Sort -->
            <div class="flex flex-wrap gap-4 pt-2 border-t border-gray-200 dark:border-gray-700">
              <!-- Assignee -->
              <div class="flex-shrink-0">
                <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">Assignee</label>
                <select x-model="filters.assignee" @change="applyFilter()"
                        class="px-3 py-1.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm">
                  <option value="">All</option>
                  <template x-for="assignee in filterOptions.assignees" :key="assignee">
                    <option :value="assignee" x-text="assignee"></option>
                  </template>
                </select>
              </div>

              <!-- Blocked toggle -->
              <div class="flex-shrink-0">
                <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">Blocked</label>
                <div class="flex rounded-lg border border-gray-300 dark:border-gray-600 overflow-hidden">
                  <button @click="filters.hasBlockers = null; applyFilter()"
                          :class="filters.hasBlockers === null ? 'bg-beads-500 text-white' : 'bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300'"
                          class="px-3 py-1.5 text-xs font-medium">All</button>
                  <button @click="filters.hasBlockers = false; applyFilter()"
                          :class="filters.hasBlockers === false ? 'bg-green-500 text-white' : 'bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300'"
                          class="px-3 py-1.5 text-xs font-medium border-l border-gray-300 dark:border-gray-600">Ready</button>
                  <button @click="filters.hasBlockers = true; applyFilter()"
                          :class="filters.hasBlockers === true ? 'bg-red-500 text-white' : 'bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300'"
                          class="px-3 py-1.5 text-xs font-medium border-l border-gray-300 dark:border-gray-600">Blocked</button>
                </div>
              </div>

              <!-- Is Blocking toggle -->
              <div class="flex-shrink-0">
                <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">Blocking</label>
                <div class="flex rounded-lg border border-gray-300 dark:border-gray-600 overflow-hidden">
                  <button @click="filters.isBlocking = null; applyFilter()"
                          :class="filters.isBlocking === null ? 'bg-beads-500 text-white' : 'bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300'"
                          class="px-3 py-1.5 text-xs font-medium">All</button>
                  <button @click="filters.isBlocking = true; applyFilter()"
                          :class="filters.isBlocking === true ? 'bg-orange-500 text-white' : 'bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300'"
                          class="px-3 py-1.5 text-xs font-medium border-l border-gray-300 dark:border-gray-600">Blockers</button>
                </div>
              </div>

              <!-- Sort -->
              <div class="flex-shrink-0 ml-auto">
                <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">Sort by</label>
                <select x-model="sort" @change="applyFilter()"
                        class="px-3 py-1.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm">
                  <option value="priority">Priority</option>
                  <option value="updated">Updated</option>
                  <option value="created">Created</option>
                  <option value="score">Triage Score</option>
                  <option value="blocks">Blocks Count</option>
                  <option value="title">Title</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <!-- Results count -->
        <div class="mb-4 flex items-center justify-between">
          <p class="text-sm text-gray-600 dark:text-gray-400">
            Showing <span class="font-medium" x-text="issues.length"></span> of
            <span class="font-medium" x-text="totalIssues"></span> issues
          </p>
          <div class="flex items-center space-x-2 text-sm text-gray-500">
            <span>Page <span x-text="page"></span> of <span x-text="Math.ceil(totalIssues / pageSize) || 1"></span></span>
          </div>
        </div>

        <!-- Issues list -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700">
          <div class="divide-y divide-gray-200 dark:divide-gray-700">
            <template x-for="issue in issues" :key="issue.id">
              <div class="p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 cursor-pointer transition-colors group"
                   :class="'priority-' + issue.priority"
                   @click="showIssue(issue.id)">
                <div class="flex items-start justify-between">
                  <div class="flex-1">
                    <div class="flex items-center space-x-2">
                      <span class="text-xs font-mono text-gray-500 dark:text-gray-400" x-text="issue.id"></span>
                      <span class="px-2 py-0.5 text-xs font-medium rounded bg-gray-100 dark:bg-gray-700" x-text="issue.issue_type"></span>
                      <span x-show="isOnCriticalPath(issue.id)"
                            class="px-2 py-0.5 text-xs font-medium rounded bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 animate-pulse">
                         Critical Path #<span x-text="getCriticalPathPosition(issue.id)"></span>
                      </span>
                    </div>
                    <h3 class="font-medium mt-1" x-text="issue.title"></h3>
                    <p x-show="issue.description" class="text-sm text-gray-500 dark:text-gray-400 mt-1 line-clamp-2" x-text="issue.description"></p>
                  </div>
                  <div class="flex flex-col items-end space-y-2 ml-4">
                    <span class="px-2 py-1 text-xs font-medium rounded-full"
                          :class="'status-' + issue.status"
                          x-text="issue.status"></span>
                    <span class="text-xs text-gray-500 dark:text-gray-400" x-text="formatDate(issue.updated_at)"></span>
                  </div>
                </div>
                <div class="flex items-center space-x-4 mt-3 text-xs text-gray-500 dark:text-gray-400">
                  <span x-show="issue.assignee"><span class="font-medium">Assignee:</span> <span x-text="issue.assignee"></span></span>
                  <span x-show="issue.blocks_count"><span class="font-medium">Blocks:</span> <span x-text="issue.blocks_count"></span></span>
                  <span x-show="issue.blocked_by_count"><span class="font-medium">Blocked by:</span> <span x-text="issue.blocked_by_count"></span></span>
                </div>
              </div>
            </template>
          </div>

          <!-- Pagination -->
          <div class="px-4 py-3 border-t border-gray-200 dark:border-gray-700 flex items-center justify-between">
            <p class="text-sm text-gray-500 dark:text-gray-400">
              Showing <span x-text="(page - 1) * pageSize + 1"></span> - <span x-text="Math.min(page * pageSize, totalIssues)"></span> of <span x-text="totalIssues"></span>
            </p>
            <div class="flex items-center gap-2">
              <button @click="prevPage()" :disabled="page === 1"
                      class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm font-medium hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:bg-white dark:disabled:hover:bg-gray-700 transition-colors">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                </svg>
                Previous
              </button>
              <span class="text-sm text-gray-500 dark:text-gray-400 tabular-nums" x-text="page + ' / ' + Math.ceil(totalIssues / pageSize)"></span>
              <button @click="nextPage()" :disabled="page * pageSize >= totalIssues"
                      class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm font-medium hover:bg-gray-50 dark:hover:bg-gray-600 disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:bg-white dark:disabled:hover:bg-gray-700 transition-colors">
                Next
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Insights view -->
      <div x-show="view === 'insights'">
        <!-- Graph Health Overview -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
          <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-5">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-gray-500 dark:text-gray-400">Nodes</p>
                <p class="text-2xl font-bold mt-1" x-text="graphReady ? (stats.open + stats.in_progress + stats.blocked) : '-'"></p>
              </div>
              <div class="w-10 h-10 bg-beads-100 dark:bg-beads-900 rounded-lg flex items-center justify-center">
                <svg class="w-5 h-5 text-beads-600 dark:text-beads-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <circle cx="12" cy="12" r="3" stroke-width="2"/>
                  <path stroke-linecap="round" stroke-width="2" d="M12 2v4m0 12v4M2 12h4m12 0h4"/>
                </svg>
              </div>
            </div>
          </div>

          <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-5">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-gray-500 dark:text-gray-400">Graph Ready</p>
                <p class="text-2xl font-bold mt-1" :class="graphReady ? 'text-green-600' : 'text-yellow-600'" x-text="graphReady ? 'Yes' : 'No'"></p>
              </div>
              <div class="w-10 h-10 rounded-lg flex items-center justify-center"
                   :class="graphReady ? 'bg-green-100 dark:bg-green-900' : 'bg-yellow-100 dark:bg-yellow-900'">
                <svg x-show="graphReady" class="w-5 h-5 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                <svg x-show="!graphReady" class="w-5 h-5 text-yellow-600 dark:text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
              </div>
            </div>
          </div>

          <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-5">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-gray-500 dark:text-gray-400">Cycles</p>
                <p class="text-2xl font-bold mt-1"
                   :class="cycleInfo?.hasCycles ? 'text-red-600' : 'text-green-600'"
                   x-text="cycleInfo?.hasCycles ? (cycleInfo.cycleCount || 'Found') : 'None'"></p>
              </div>
              <div class="w-10 h-10 rounded-lg flex items-center justify-center"
                   :class="cycleInfo?.hasCycles ? 'bg-red-100 dark:bg-red-900' : 'bg-green-100 dark:bg-green-900'">
                <svg x-show="!cycleInfo?.hasCycles" class="w-5 h-5 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <svg x-show="cycleInfo?.hasCycles" class="w-5 h-5 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                </svg>
              </div>
            </div>
          </div>

          <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-5">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-gray-500 dark:text-gray-400">Actionable</p>
                <p class="text-2xl font-bold mt-1 text-emerald-600" x-text="stats.actionable || 0"></p>
              </div>
              <div class="w-10 h-10 bg-emerald-100 dark:bg-emerald-900 rounded-lg flex items-center justify-center">
                <svg class="w-5 h-5 text-emerald-600 dark:text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                </svg>
              </div>
            </div>
          </div>
        </div>

        <!-- Top-K Recommendations -->
        <div x-show="topKSet && topKSet.items?.length > 0" class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 mb-6">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-semibold flex items-center">
              <svg class="w-5 h-5 text-purple-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
              </svg>
              Optimal Next Steps
            </h2>
            <span class="text-xs text-gray-500 dark:text-gray-400">Greedy top-k: close these to maximize unblocks</span>
          </div>
          <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
            Total potential unblocks: <span class="font-semibold text-purple-600" x-text="topKSet?.total_unblocked || 0"></span>
          </p>
          <div class="space-y-3">
            <template x-for="(item, idx) in topKSet?.items || []" :key="item.issueId">
              <div class="p-4 bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 rounded-lg cursor-pointer hover:bg-purple-100 dark:hover:bg-purple-900/30 transition-colors"
                   @click="showIssue(item.issueId)">
                <div class="flex items-start justify-between">
                  <div class="flex-1 min-w-0">
                    <div class="flex items-center">
                      <span class="w-6 h-6 bg-purple-200 dark:bg-purple-800 rounded-full flex items-center justify-center text-xs font-bold text-purple-800 dark:text-purple-200 mr-2" x-text="idx + 1"></span>
                      <span class="text-xs font-mono text-purple-600 dark:text-purple-400" x-text="item.issueId"></span>
                    </div>
                    <h3 class="font-medium mt-1" x-text="getIssue(item.issueId)?.title || item.issueId"></h3>
                  </div>
                  <div class="ml-4 text-right">
                    <span class="px-2 py-1 text-xs font-medium bg-purple-200 dark:bg-purple-800 text-purple-800 dark:text-purple-200 rounded">
                      +<span x-text="item.marginal_unblocked"></span> unblocked
                    </span>
                  </div>
                </div>
                <div x-show="item.unblocked_issue_ids?.length > 0" class="mt-2 flex flex-wrap gap-1">
                  <template x-for="unblockedId in (item.unblocked_issue_ids || []).slice(0, 5)" :key="unblockedId">
                    <span class="px-1.5 py-0.5 text-xs font-mono bg-green-100 dark:bg-green-900/50 text-green-700 dark:text-green-300 rounded"
                          x-text="unblockedId"></span>
                  </template>
                  <span x-show="(item.unblocked_issue_ids || []).length > 5" class="text-xs text-gray-500">
                    +<span x-text="item.unblocked_issue_ids.length - 5"></span> more
                  </span>
                </div>
              </div>
            </template>
          </div>
        </div>

        <!-- What-If Cascade Preview -->
        <div x-show="topImpactIssues?.length > 0" class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 mb-6">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-semibold flex items-center">
              <svg class="w-5 h-5 text-cyan-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
              </svg>
              Highest Cascade Impact
            </h2>
            <span class="text-xs text-gray-500 dark:text-gray-400">What-if: closing these unlocks the most downstream work</span>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
            <template x-for="item in topImpactIssues.slice(0, 6)" :key="item.issueId">
              <div class="p-3 bg-cyan-50 dark:bg-cyan-900/20 border border-cyan-200 dark:border-cyan-800 rounded-lg cursor-pointer hover:bg-cyan-100 dark:hover:bg-cyan-900/30 transition-colors"
                   @click="showIssue(item.issueId)">
                <div class="flex items-start justify-between">
                  <div class="flex-1 min-w-0">
                    <span class="text-xs font-mono text-cyan-600 dark:text-cyan-400" x-text="item.issueId"></span>
                    <h3 class="font-medium truncate text-sm mt-0.5" x-text="getIssue(item.issueId)?.title || item.issueId"></h3>
                  </div>
                  <span class="ml-2 px-2 py-0.5 text-xs font-medium bg-cyan-200 dark:bg-cyan-800 text-cyan-800 dark:text-cyan-200 rounded">
                    <span x-text="item.result?.cascade_depth || item.result?.total_unblocked || '?'"></span>
                    <span x-text="item.result?.total_unblocked ? ' unblock' : ' deep'"></span>
                  </span>
                </div>
              </div>
            </template>
          </div>
        </div>

        <!-- Cycle Navigator -->
        <div x-show="cycleInfo?.hasCycles" x-data="{ cycleNav: { active: false, currentIndex: 0, cycleCount: 0, currentPath: '' } }"
             x-init="$watch('cycleInfo', () => { if(cycleInfo?.hasCycles) { cycleNav.cycleCount = cycleInfo.cycleCount || 0; } })"
             @bv-graph:cycle-highlight-change.window="cycleNav.active = true; cycleNav.currentIndex = $event.detail.currentIndex; cycleNav.cycleCount = $event.detail.cycleCount; cycleNav.currentPath = $event.detail.cyclePath"
             @bv-graph:cycle-navigator-reset.window="cycleNav.active = false; cycleNav.currentPath = ''"
             class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-red-200 dark:border-red-800 p-6 mb-6">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-semibold flex items-center text-red-600 dark:text-red-400">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
              </svg>
              Cycle Navigator
            </h2>
            <span class="text-xs text-gray-500 dark:text-gray-400">Press <kbd class="px-1 py-0.5 bg-gray-100 dark:bg-gray-700 rounded text-xs">y</kbd> to toggle, <kbd class="px-1 py-0.5 bg-gray-100 dark:bg-gray-700 rounded text-xs">[</kbd>/<kbd class="px-1 py-0.5 bg-gray-100 dark:bg-gray-700 rounded text-xs">]</kbd> to navigate</span>
          </div>

          <!-- Cycle counter and navigation -->
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center space-x-4">
              <button @click="if(typeof prevCycle === 'function') prevCycle(); else if(window.BvGraph) window.BvGraph.prevCycle();"
                      :disabled="!cycleNav.active || cycleNav.cycleCount <= 1"
                      class="px-3 py-1.5 rounded-lg border border-red-300 dark:border-red-700 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/30 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                </svg>
              </button>
              <span class="text-lg font-semibold text-red-600 dark:text-red-400">
                Cycle <span x-text="cycleNav.active ? cycleNav.currentIndex + 1 : ''"></span> of <span x-text="cycleNav.cycleCount || cycleInfo?.cycleCount || ''"></span>
              </span>
              <button @click="if(typeof nextCycle === 'function') nextCycle(); else if(window.BvGraph) window.BvGraph.nextCycle();"
                      :disabled="!cycleNav.active || cycleNav.cycleCount <= 1"
                      class="px-3 py-1.5 rounded-lg border border-red-300 dark:border-red-700 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/30 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
              </button>
            </div>

            <div class="flex items-center space-x-2">
              <button @click="if(typeof toggleCycleNavigator === 'function') toggleCycleNavigator(); else if(window.BvGraph) window.BvGraph.toggleCycleNavigator();"
                      class="px-3 py-1.5 rounded-lg bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 hover:bg-red-200 dark:hover:bg-red-900/50 transition-colors text-sm font-medium">
                <span x-text="cycleNav.active ? 'Reset View' : 'Highlight Cycles'"></span>
              </button>
              <button x-show="cycleNav.active"
                      @click="if(typeof zoomToCycle === 'function') zoomToCycle(); else if(window.BvGraph) window.BvGraph.zoomToCycle();"
                      class="px-3 py-1.5 rounded-lg bg-red-600 text-white hover:bg-red-700 transition-colors text-sm font-medium">
                Zoom to Cycle
              </button>
            </div>
          </div>

          <!-- Current cycle path -->
          <div x-show="cycleNav.active && cycleNav.currentPath" class="p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg">
            <p class="text-xs text-red-500 dark:text-red-400 mb-1 font-medium">Current Cycle Path:</p>
            <p class="text-sm font-mono text-red-700 dark:text-red-300 break-all" x-text="cycleNav.currentPath"></p>
          </div>

          <div x-show="!cycleNav.active" class="p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg">
            <p class="text-sm text-red-600 dark:text-red-400">
              Click "Highlight Cycles" or press <kbd class="px-1 py-0.5 bg-red-100 dark:bg-red-800 rounded text-xs">y</kbd> to start exploring cycles in the graph.
            </p>
          </div>
        </div>

        <!-- Cycle Break Suggestions -->
        <div x-show="cycleInfo?.hasCycles && cycleInfo?.suggestions" class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-red-200 dark:border-red-800 p-6 mb-6">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-semibold flex items-center text-red-600 dark:text-red-400">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
              </svg>
              Cycle Break Suggestions
            </h2>
            <span class="text-xs text-gray-500 dark:text-gray-400">Edges to remove to break dependency cycles</span>
          </div>
          <p class="text-sm text-red-600 dark:text-red-400 mb-4">
            Circular dependencies detected. Consider removing these edges:
          </p>
          <div class="space-y-2">
            <template x-for="suggestion in cycleInfo?.suggestions?.suggestions || []" :key="suggestion.from + '-' + suggestion.to">
              <div class="p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg">
                <div class="flex items-center justify-between">
                  <div class="flex items-center space-x-2">
                    <span class="px-2 py-1 text-xs font-mono bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded cursor-pointer hover:bg-red-200 dark:hover:bg-red-800"
                          @click="showIssue(suggestion.from_id || suggestion.from)"
                          x-text="suggestion.from_id || suggestion.from"></span>
                    <svg class="w-4 h-4 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
                    </svg>
                    <span class="px-2 py-1 text-xs font-mono bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded cursor-pointer hover:bg-red-200 dark:hover:bg-red-800"
                          @click="showIssue(suggestion.to_id || suggestion.to)"
                          x-text="suggestion.to_id || suggestion.to"></span>
                  </div>
                  <span x-show="suggestion.cycles_broken" class="text-xs text-red-600 dark:text-red-400">
                    breaks <span x-text="suggestion.cycles_broken"></span> cycle(s)
                  </span>
                </div>
              </div>
            </template>
          </div>
        </div>

        <!-- Core Graph Metrics -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6 mb-6">
          <h2 class="text-lg font-semibold mb-4">Graph Metrics</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <!-- Bottlenecks (Betweenness) -->
            <div>
              <h3 class="font-medium text-gray-700 dark:text-gray-300 mb-1 flex items-center">
                <svg class="w-4 h-4 text-orange-500 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                </svg>
                Bottlenecks
              </h3>
              <p class="text-xs text-gray-500 dark:text-gray-400 mb-3">High betweenness centrality</p>
              <div class="space-y-2">
                <template x-for="issue in topByBetweenness.slice(0, 5)" :key="issue.id">
                  <div class="flex items-center justify-between p-2 rounded hover:bg-gray-50 dark:hover:bg-gray-700/50 cursor-pointer"
                       @click="showIssue(issue.id)">
                    <span class="text-sm truncate flex-1" x-text="issue.title"></span>
                    <span class="text-xs font-mono text-orange-500 ml-2" x-text="(issue.betweenness || 0).toFixed(3)"></span>
                  </div>
                </template>
                <p x-show="topByBetweenness.length === 0" class="text-xs text-gray-400 text-center py-2">No data</p>
              </div>
            </div>

            <!-- Keystones (Critical Path) -->
            <div>
              <h3 class="font-medium text-gray-700 dark:text-gray-300 mb-1 flex items-center">
                <svg class="w-4 h-4 text-indigo-500 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                </svg>
                Keystones
              </h3>
              <p class="text-xs text-gray-500 dark:text-gray-400 mb-3">Critical path depth</p>
              <div class="space-y-2">
                <template x-for="issue in topByCriticalPath.slice(0, 5)" :key="issue.id">
                  <div class="flex items-center justify-between p-2 rounded hover:bg-gray-50 dark:hover:bg-gray-700/50 cursor-pointer"
                       @click="showIssue(issue.id)">
                    <span class="text-sm truncate flex-1" x-text="issue.title"></span>
                    <span class="text-xs font-mono text-indigo-500 ml-2" x-text="issue.critical_path_depth || '?'"></span>
                  </div>
                </template>
                <p x-show="topByCriticalPath.length === 0" class="text-xs text-gray-400 text-center py-2">No data</p>
              </div>
            </div>

            <!-- Influencers (PageRank) -->
            <div>
              <h3 class="font-medium text-gray-700 dark:text-gray-300 mb-1 flex items-center">
                <svg class="w-4 h-4 text-blue-500 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                </svg>
                Influencers
              </h3>
              <p class="text-xs text-gray-500 dark:text-gray-400 mb-3">Top by PageRank</p>
              <div class="space-y-2">
                <template x-for="issue in topByPageRank.slice(0, 5)" :key="issue.id">
                  <div class="flex items-center justify-between p-2 rounded hover:bg-gray-50 dark:hover:bg-gray-700/50 cursor-pointer"
                       @click="showIssue(issue.id)">
                    <span class="text-sm truncate flex-1" x-text="issue.title"></span>
                    <span class="text-xs font-mono text-blue-500 ml-2" x-text="issue.pagerank?.toFixed(4)"></span>
                  </div>
                </template>
                <p x-show="topByPageRank.length === 0" class="text-xs text-gray-400 text-center py-2">No data</p>
              </div>
            </div>

            <!-- Most Blocking -->
            <div>
              <h3 class="font-medium text-gray-700 dark:text-gray-300 mb-1 flex items-center">
                <svg class="w-4 h-4 text-red-500 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"/>
                </svg>
                Most Blocking
              </h3>
              <p class="text-xs text-gray-500 dark:text-gray-400 mb-3">Direct blockers count</p>
              <div class="space-y-2">
                <template x-for="issue in topBlockers.slice(0, 5)" :key="issue.id">
                  <div class="flex items-center justify-between p-2 rounded hover:bg-gray-50 dark:hover:bg-gray-700/50 cursor-pointer"
                       @click="showIssue(issue.id)">
                    <span class="text-sm truncate flex-1" x-text="issue.title"></span>
                    <span class="text-xs font-mono text-red-500 ml-2">
                      <span x-text="issue.blocks_count"></span>
                    </span>
                  </div>
                </template>
                <p x-show="topBlockers.length === 0" class="text-xs text-gray-400 text-center py-2">No data</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Triage Scores -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
          <h2 class="text-lg font-semibold mb-4">Triage Rankings</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <h3 class="font-medium text-gray-700 dark:text-gray-300 mb-3">Top by Triage Score</h3>
              <div class="space-y-2">
                <template x-for="issue in topByTriageScore.slice(0, 10)" :key="issue.id">
                  <div class="flex items-center justify-between p-2 rounded hover:bg-gray-50 dark:hover:bg-gray-700/50 cursor-pointer"
                       @click="showIssue(issue.id)">
                    <div class="flex items-center min-w-0 flex-1">
                      <span class="text-xs font-mono text-gray-400 mr-2 w-16" x-text="issue.id"></span>
                      <span class="text-sm truncate" x-text="issue.title"></span>
                    </div>
                    <span class="text-xs font-mono text-emerald-500 ml-2" x-text="issue.triage_score?.toFixed(3)"></span>
                  </div>
                </template>
              </div>
            </div>
            <div>
              <h3 class="font-medium text-gray-700 dark:text-gray-300 mb-3">Triage Score Distribution</h3>
              <div class="space-y-2">
                <div class="flex items-center text-sm">
                  <span class="w-24 text-gray-500">High (>0.7)</span>
                  <div class="flex-1 mx-2 h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                    <div class="h-full bg-emerald-500 rounded-full"
                         :style="'width: ' + ((topByTriageScore.filter(i => i.triage_score > 0.7).length / Math.max(topByTriageScore.length, 1)) * 100) + '%'"></div>
                  </div>
                  <span class="w-8 text-right font-mono text-xs" x-text="topByTriageScore.filter(i => i.triage_score > 0.7).length"></span>
                </div>
                <div class="flex items-center text-sm">
                  <span class="w-24 text-gray-500">Medium</span>
                  <div class="flex-1 mx-2 h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                    <div class="h-full bg-yellow-500 rounded-full"
                         :style="'width: ' + ((topByTriageScore.filter(i => i.triage_score > 0.3 && i.triage_score <= 0.7).length / Math.max(topByTriageScore.length, 1)) * 100) + '%'"></div>
                  </div>
                  <span class="w-8 text-right font-mono text-xs" x-text="topByTriageScore.filter(i => i.triage_score > 0.3 && i.triage_score <= 0.7).length"></span>
                </div>
                <div class="flex items-center text-sm">
                  <span class="w-24 text-gray-500">Low (<0.3)</span>
                  <div class="flex-1 mx-2 h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                    <div class="h-full bg-gray-400 rounded-full"
                         :style="'width: ' + ((topByTriageScore.filter(i => i.triage_score <= 0.3).length / Math.max(topByTriageScore.length, 1)) * 100) + '%'"></div>
                  </div>
                  <span class="w-8 text-right font-mono text-xs" x-text="topByTriageScore.filter(i => i.triage_score <= 0.3).length"></span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </main>

    <!-- Full-frame Graph View (outside main for full viewport) -->
    <div x-show="view === 'graph'"
         x-data="{ currentPreset: 'force', showControls: true }"
         class="fixed inset-0 z-40 bg-gray-50 dark:bg-gray-900"
         style="top: 64px;">

      <!-- Graph Canvas - Full viewport -->
      <div id="graph-container" class="w-full h-full">
        <p class="text-gray-500 dark:text-gray-400 text-center py-8">Graph visualization loading...</p>
      </div>

      <!-- Floating Control Panel -->
      <div class="absolute top-4 left-4 right-4 flex items-start justify-between pointer-events-none">
        <!-- Left controls -->
        <div class="pointer-events-auto flex flex-col gap-3">
          <!-- Back button -->
          <button @click="view = 'dashboard'"
                  class="flex items-center gap-2 px-4 py-2 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
            </svg>
            <span class="text-sm font-medium">Back to Dashboard</span>
          </button>

          <!-- Stats overlay -->
          <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 p-3">
            <div class="text-xs text-gray-500 dark:text-gray-400 mb-1">Showing</div>
            <div class="flex items-center gap-4">
              <div class="flex items-center gap-1.5">
                <div class="w-2 h-2 rounded-full bg-blue-500"></div>
                <span class="text-sm font-medium" x-text="(stats.open || 0) + ' open'"></span>
              </div>
              <div class="flex items-center gap-1.5">
                <div class="w-2 h-2 rounded-full bg-green-500"></div>
                <span class="text-sm font-medium" x-text="(stats.closed || 0) + ' closed'"></span>
              </div>
            </div>
          </div>
        </div>

        <!-- Right controls - Layout presets -->
        <div class="pointer-events-auto">
          <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 p-2">
            <div class="text-xs text-gray-500 dark:text-gray-400 mb-2 px-1">Layout</div>
            <div class="grid grid-cols-3 gap-1">
              <button @click="applyGraphPreset('force'); currentPreset = 'force'"
                      :class="currentPreset === 'force' ? 'bg-beads-100 dark:bg-beads-900 text-beads-700 dark:text-beads-300 ring-1 ring-beads-500' : 'hover:bg-gray-100 dark:hover:bg-gray-700'"
                      class="px-2 py-1.5 text-xs rounded-md transition-colors flex items-center gap-1" title="Standard force-directed">
                <span></span> Force
              </button>
              <button @click="applyGraphPreset('compact'); currentPreset = 'compact'"
                      :class="currentPreset === 'compact' ? 'bg-beads-100 dark:bg-beads-900 text-beads-700 dark:text-beads-300 ring-1 ring-beads-500' : 'hover:bg-gray-100 dark:hover:bg-gray-700'"
                      class="px-2 py-1.5 text-xs rounded-md transition-colors flex items-center gap-1" title="Compact DAG">
                <span></span> Compact
              </button>
              <button @click="applyGraphPreset('spread'); currentPreset = 'spread'"
                      :class="currentPreset === 'spread' ? 'bg-beads-100 dark:bg-beads-900 text-beads-700 dark:text-beads-300 ring-1 ring-beads-500' : 'hover:bg-gray-100 dark:hover:bg-gray-700'"
                      class="px-2 py-1.5 text-xs rounded-md transition-colors flex items-center gap-1" title="Maximum spacing">
                <span></span> Spread
              </button>
              <button @click="applyGraphPreset('orthogonal'); currentPreset = 'orthogonal'"
                      :class="currentPreset === 'orthogonal' ? 'bg-beads-100 dark:bg-beads-900 text-beads-700 dark:text-beads-300 ring-1 ring-beads-500' : 'hover:bg-gray-100 dark:hover:bg-gray-700'"
                      class="px-2 py-1.5 text-xs rounded-md transition-colors flex items-center gap-1" title="Grid-aligned">
                <span></span> Grid
              </button>
              <button @click="applyGraphPreset('radial'); currentPreset = 'radial'"
                      :class="currentPreset === 'radial' ? 'bg-beads-100 dark:bg-beads-900 text-beads-700 dark:text-beads-300 ring-1 ring-beads-500' : 'hover:bg-gray-100 dark:hover:bg-gray-700'"
                      class="px-2 py-1.5 text-xs rounded-md transition-colors flex items-center gap-1" title="Radial from center">
                <span></span> Radial
              </button>
              <button @click="applyGraphPreset('cluster'); currentPreset = 'cluster'"
                      :class="currentPreset === 'cluster' ? 'bg-beads-100 dark:bg-beads-900 text-beads-700 dark:text-beads-300 ring-1 ring-beads-500' : 'hover:bg-gray-100 dark:hover:bg-gray-700'"
                      class="px-2 py-1.5 text-xs rounded-md transition-colors flex items-center gap-1" title="Group by status">
                <span></span> Cluster
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Bottom legend -->
      <div class="absolute bottom-4 left-4 pointer-events-auto">
        <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 p-3">
          <div class="text-xs text-gray-500 dark:text-gray-400 mb-2">Legend</div>
          <div class="flex flex-wrap gap-x-4 gap-y-1 text-xs">
            <div class="flex items-center gap-1.5"><div class="w-3 h-3 rounded-full bg-blue-500"></div> Open</div>
            <div class="flex items-center gap-1.5"><div class="w-3 h-3 rounded-full bg-yellow-500"></div> In Progress</div>
            <div class="flex items-center gap-1.5"><div class="w-3 h-3 rounded-full bg-green-500"></div> Closed</div>
            <div class="flex items-center gap-1.5"><div class="w-3 h-3 rounded-full bg-red-500"></div> Blocked</div>
          </div>
          <div class="mt-2 pt-2 border-t border-gray-200 dark:border-gray-700 text-xs text-gray-500 dark:text-gray-400">
            Click nodes to view details. Drag to pan, scroll to zoom.
          </div>
        </div>
      </div>
    </div>

    <!-- Issue detail modal -->
    <div x-show="selectedIssue"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-150"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-50 overflow-y-auto"
         @keydown.escape.window="closeIssue()"
         @keydown.j.window="selectedIssue && navigateIssue(1)"
         @keydown.k.window="selectedIssue && navigateIssue(-1)"
         @keydown.g.window="selectedIssue && (showDepGraph = !showDepGraph)">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black/50" @click="closeIssue()"></div>
        <div class="relative bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-3xl w-full max-h-[85vh] overflow-y-auto">
          <template x-if="selectedIssue">
            <div class="p-6">
              <!-- Header -->
              <div class="flex items-start justify-between mb-4">
                <div class="flex-1 min-w-0">
                  <div class="flex items-center space-x-2">
                    <a :href="'#/issue/' + encodeURIComponent(selectedIssue.id)"
                       class="text-sm font-mono text-beads-600 dark:text-beads-400 hover:underline"
                       x-text="selectedIssue.id"></a>
                    <span class="hidden sm:inline text-xs text-gray-400 dark:text-gray-500">|</span>
                    <span class="hidden sm:inline text-xs text-gray-500 dark:text-gray-400">Press <kbd class="px-1.5 py-0.5 bg-gray-200 dark:bg-gray-700 rounded text-xs">j</kbd>/<kbd class="px-1.5 py-0.5 bg-gray-200 dark:bg-gray-700 rounded text-xs">k</kbd> next/prev, <kbd class="px-1.5 py-0.5 bg-gray-200 dark:bg-gray-700 rounded text-xs">h</kbd>/<kbd class="px-1.5 py-0.5 bg-gray-200 dark:bg-gray-700 rounded text-xs">l</kbd> deps, <kbd class="px-1.5 py-0.5 bg-gray-200 dark:bg-gray-700 rounded text-xs">?</kbd> help</span>
                  </div>
                  <h2 class="text-xl font-semibold mt-1" x-text="selectedIssue.title"></h2>
                </div>
                <button @click="closeIssue()" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg shrink-0 ml-4">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                  </svg>
                </button>
              </div>

              <!-- Badges -->
              <div class="flex flex-wrap gap-2 mb-4">
                <span class="px-2 py-1 text-xs font-medium rounded-full" :class="'status-' + selectedIssue.status" x-text="selectedIssue.status"></span>
                <span class="px-2 py-1 text-xs font-medium rounded"
                      :class="{
                        'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300': selectedIssue.priority === 0,
                        'bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300': selectedIssue.priority === 1,
                        'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300': selectedIssue.priority === 2,
                        'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300': selectedIssue.priority >= 3
                      }"
                      x-text="'P' + selectedIssue.priority"></span>
                <span class="px-2 py-1 text-xs font-medium rounded bg-gray-100 dark:bg-gray-700" x-text="selectedIssue.issue_type"></span>
                <template x-if="selectedIssue.labels">
                  <template x-for="label in parseLabels(selectedIssue.labels)" :key="label">
                    <span class="px-2 py-1 text-xs font-medium rounded bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300" x-text="label"></span>
                  </template>
                </template>
              </div>

              <!-- Description -->
              <div x-show="selectedIssue.description" class="prose dark:prose-invert max-w-none mb-6 text-sm">
                <div x-html="renderMarkdown(selectedIssue.description)"></div>
              </div>

              <!-- Graph Metrics Section -->
              <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6 p-4 bg-gray-50 dark:bg-gray-900/50 rounded-lg">
                <div class="text-center">
                  <div class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide">PageRank</div>
                  <div class="text-lg font-semibold text-beads-600 dark:text-beads-400" x-text="selectedIssue.pagerank ? selectedIssue.pagerank.toFixed(4) : ''"></div>
                </div>
                <div class="text-center">
                  <div class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide">Betweenness</div>
                  <div class="text-lg font-semibold text-beads-600 dark:text-beads-400" x-text="selectedIssue.betweenness ? selectedIssue.betweenness.toFixed(4) : ''"></div>
                </div>
                <div class="text-center">
                  <div class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide">Critical Path</div>
                  <div class="text-lg font-semibold text-beads-600 dark:text-beads-400" x-text="selectedIssue.critical_path_depth ?? ''"></div>
                </div>
                <div class="text-center">
                  <div class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide">Triage Score</div>
                  <div class="text-lg font-semibold text-beads-600 dark:text-beads-400" x-text="selectedIssue.triage_score ? selectedIssue.triage_score.toFixed(3) : ''"></div>
                </div>
              </div>

              <!-- Metadata Grid -->
              <div class="grid grid-cols-2 gap-4 text-sm mb-6">
                <div x-show="selectedIssue.assignee">
                  <span class="text-gray-500 dark:text-gray-400">Assignee:</span>
                  <span class="ml-2 font-medium" x-text="selectedIssue.assignee"></span>
                </div>
                <div>
                  <span class="text-gray-500 dark:text-gray-400">Created:</span>
                  <span class="ml-2" x-text="formatDate(selectedIssue.created_at)"></span>
                </div>
                <div>
                  <span class="text-gray-500 dark:text-gray-400">Updated:</span>
                  <span class="ml-2" x-text="formatDate(selectedIssue.updated_at)"></span>
                </div>
                <div x-show="selectedIssue.closed_at">
                  <span class="text-gray-500 dark:text-gray-400">Closed:</span>
                  <span class="ml-2" x-text="formatDate(selectedIssue.closed_at)"></span>
                </div>
              </div>

              <!-- Dependencies Section -->
              <div x-show="selectedIssue.blocks_ids || selectedIssue.blocked_by_ids" class="pt-6 border-t border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-between mb-4">
                  <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300">Dependencies</h3>
                  <button @click="showDepGraph = !showDepGraph"
                          class="flex items-center space-x-1 px-3 py-1.5 text-xs font-medium rounded-lg transition-colors"
                          :class="showDepGraph ? 'bg-beads-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                    </svg>
                    <span x-text="showDepGraph ? 'Hide Graph' : 'Show Graph'"></span>
                  </button>
                </div>

                <!-- Dependency Lists -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                  <div x-show="selectedIssue.blocked_by_ids">
                    <h4 class="text-xs font-medium text-gray-500 dark:text-gray-400 mb-2 flex items-center">
                      <svg class="w-3 h-3 mr-1 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/>
                      </svg>
                      Blocked By (<span x-text="(selectedIssue.blocked_by_ids || '').split(',').filter(Boolean).length"></span>)
                    </h4>
                    <div class="flex flex-wrap gap-1.5">
                      <template x-for="id in (selectedIssue.blocked_by_ids || '').split(',').filter(Boolean)" :key="id">
                        <button @click="showIssue(id.trim())"
                                class="px-2 py-1 text-xs font-mono bg-yellow-50 dark:bg-yellow-900/20 text-yellow-700 dark:text-yellow-300 rounded hover:bg-yellow-100 dark:hover:bg-yellow-900/40 transition-colors"
                                x-text="id.trim()"></button>
                      </template>
                    </div>
                  </div>
                  <div x-show="selectedIssue.blocks_ids">
                    <h4 class="text-xs font-medium text-gray-500 dark:text-gray-400 mb-2 flex items-center">
                      <svg class="w-3 h-3 mr-1 text-red-500" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M13.477 14.89A6 6 0 015.11 6.524l8.367 8.368zm1.414-1.414L6.524 5.11a6 6 0 018.367 8.367zM18 10a8 8 0 11-16 0 8 8 0 0116 0z" clip-rule="evenodd"/>
                      </svg>
                      Blocks (<span x-text="(selectedIssue.blocks_ids || '').split(',').filter(Boolean).length"></span>)
                    </h4>
                    <div class="flex flex-wrap gap-1.5">
                      <template x-for="id in (selectedIssue.blocks_ids || '').split(',').filter(Boolean)" :key="id">
                        <button @click="showIssue(id.trim())"
                                class="px-2 py-1 text-xs font-mono bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300 rounded hover:bg-red-100 dark:hover:bg-red-900/40 transition-colors"
                                x-text="id.trim()"></button>
                      </template>
                    </div>
                  </div>
                </div>

                <!-- Mermaid Dependency Graph (lazy-loaded) -->
                <div x-show="showDepGraph" x-collapse class="mt-4">
                  <div class="bg-white dark:bg-gray-900 rounded-lg p-4 border border-gray-200 dark:border-gray-700">
                    <div x-ref="depGraph" class="mermaid-container overflow-x-auto">
                      <div x-init="$watch('showDepGraph', value => { if(value) renderDepGraph() })"></div>
                    </div>
                  </div>
                  <p class="text-xs text-gray-500 dark:text-gray-400 mt-2 text-center">
                    Click nodes to navigate. Current issue highlighted in blue.
                  </p>
                </div>
              </div>

              <!-- What-If Impact Section (if graph engine ready) -->
              <div x-show="graphReady && selectedIssue.status !== 'closed'" class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-between mb-3">
                  <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300">What-If Analysis</h3>
                  <button @click="computeWhatIf(selectedIssue.id)"
                          class="px-3 py-1.5 text-xs font-medium bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-300 rounded-lg hover:bg-emerald-200 dark:hover:bg-emerald-900/50 transition-colors">
                    Simulate Close
                  </button>
                </div>
                <div x-show="whatIfResult" class="bg-emerald-50 dark:bg-emerald-900/20 rounded-lg p-4">
                  <p class="text-sm text-emerald-700 dark:text-emerald-300">
                    Closing this issue would unblock <span class="font-bold" x-text="whatIfResult?.newly_unblocked || 0"></span> issue(s)
                    and enable <span class="font-bold" x-text="whatIfResult?.cascade_count || 0"></span> downstream item(s).
                  </p>
                  <div x-show="whatIfResult?.cascade_issue_ids?.length" class="mt-2">
                    <span class="text-xs text-emerald-600 dark:text-emerald-400">Cascade:</span>
                    <div class="flex flex-wrap gap-1 mt-1">
                      <template x-for="id in (whatIfResult?.cascade_issue_ids || []).slice(0, 10)" :key="id">
                        <button @click="showIssue(id)"
                                class="px-1.5 py-0.5 text-xs font-mono bg-emerald-100 dark:bg-emerald-900/40 text-emerald-700 dark:text-emerald-300 rounded hover:bg-emerald-200 dark:hover:bg-emerald-900/60"
                                x-text="id"></button>
                      </template>
                      <span x-show="(whatIfResult?.cascade_issue_ids || []).length > 10" class="text-xs text-emerald-600 dark:text-emerald-400">
                        +<span x-text="(whatIfResult?.cascade_issue_ids || []).length - 10"></span> more
                      </span>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </template>
        </div>
      </div>
    </div>

    <!-- Error Modal Overlay -->
    <div x-show="globalError"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-150"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm"
         @click.self="globalError?.dismissible && dismissError()">
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-lg w-full mx-4 overflow-hidden"
           x-transition:enter="transition ease-out duration-200"
           x-transition:enter-start="opacity-0 scale-95"
           x-transition:enter-end="opacity-100 scale-100">
        <!-- Error Header -->
        <div class="bg-red-500 px-6 py-4">
          <div class="flex items-center space-x-3">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
            </svg>
            <h3 class="text-lg font-semibold text-white" x-text="globalError?.title || 'Error'"></h3>
          </div>
        </div>
        <!-- Error Body -->
        <div class="px-6 py-4">
          <p class="text-gray-700 dark:text-gray-300" x-text="globalError?.message"></p>
          <div x-show="globalError?.details" class="mt-3">
            <details class="text-sm">
              <summary class="cursor-pointer text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200">
                Technical Details
              </summary>
              <pre class="mt-2 p-3 bg-gray-100 dark:bg-gray-900 rounded-lg text-xs overflow-x-auto font-mono text-gray-600 dark:text-gray-400"
                   x-text="globalError?.details"></pre>
            </details>
          </div>
        </div>
        <!-- Error Actions -->
        <div class="px-6 py-4 bg-gray-50 dark:bg-gray-900/50 flex justify-end space-x-3">
          <template x-for="action in (globalError?.actions || [])" :key="action.label">
            <button @click="action.handler && action.handler()"
                    :class="action.primary ? 'bg-red-500 text-white hover:bg-red-600' : 'bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600'"
                    class="px-4 py-2 rounded-lg text-sm font-medium transition-colors"
                    x-text="action.label"></button>
          </template>
          <button x-show="globalError?.dismissible"
                  @click="dismissError()"
                  class="px-4 py-2 rounded-lg text-sm font-medium bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
            Dismiss
          </button>
        </div>
      </div>
    </div>

    <!-- Toast Notifications -->
    <div class="fixed bottom-20 right-4 z-40 space-y-2 max-w-sm">
      <template x-for="toast in toasts" :key="toast.id">
        <div x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 translate-x-4"
             x-transition:enter-end="opacity-100 translate-x-0"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100 translate-x-0"
             x-transition:leave-end="opacity-0 translate-x-4"
             :class="{
               'bg-green-500': toast.type === 'success',
               'bg-red-500': toast.type === 'error',
               'bg-yellow-500': toast.type === 'warning',
               'bg-blue-500': toast.type === 'info'
             }"
             class="px-4 py-3 rounded-lg shadow-lg text-white text-sm flex items-center justify-between">
          <span x-text="toast.message"></span>
          <button @click="removeToast(toast.id)" class="ml-3 hover:opacity-70">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
      </template>
    </div>

    <!-- Diagnostics Panel (press 'd' to toggle) -->
    <div x-show="showDiagnostics"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0 translate-x-full"
         x-transition:enter-end="opacity-100 translate-x-0"
         x-transition:leave="transition ease-in duration-150"
         x-transition:leave-start="opacity-100 translate-x-0"
         x-transition:leave-end="opacity-0 translate-x-full"
         class="fixed top-0 right-0 h-full w-80 bg-white dark:bg-gray-800 shadow-2xl z-50 overflow-y-auto">
      <div class="sticky top-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 py-3 flex items-center justify-between">
        <h2 class="font-semibold text-gray-900 dark:text-gray-100">Diagnostics</h2>
        <button @click="showDiagnostics = false" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <div class="p-4 space-y-4">
        <!-- System Status -->
        <div>
          <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">System Status</h3>
          <div class="space-y-2">
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-600 dark:text-gray-400">sql.js WASM</span>
              <span :class="diagnostics.wasm ? 'text-green-500' : 'text-red-500'" x-text="diagnostics.wasm ? 'Loaded' : 'Failed'"></span>
            </div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-600 dark:text-gray-400">Graph WASM</span>
              <span :class="diagnostics.graphWasm ? 'text-green-500' : 'text-yellow-500'" x-text="diagnostics.graphWasm ? 'Loaded' : 'Unavailable'"></span>
            </div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-600 dark:text-gray-400">OPFS Cache</span>
              <span :class="diagnostics.opfs === true ? 'text-green-500' : diagnostics.opfs === false ? 'text-red-500' : 'text-gray-400'"
                    x-text="diagnostics.opfs === true ? 'Available' : diagnostics.opfs === false ? 'Unavailable' : 'Unknown'"></span>
            </div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-600 dark:text-gray-400">Fallback Mode</span>
              <span :class="wasmStatus.fallbackMode ? 'text-yellow-500' : 'text-green-500'" x-text="wasmStatus.fallbackMode ? 'Active' : 'Off'"></span>
            </div>
          </div>
          <!-- WASM Features (collapsed) -->
          <details class="mt-2 text-xs">
            <summary class="cursor-pointer text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200">
              WASM Features
            </summary>
            <div class="mt-1 space-y-1 pl-2">
              <div class="flex items-center justify-between">
                <span class="text-gray-500 dark:text-gray-400">Basic</span>
                <span :class="wasmStatus.features?.basic ? 'text-green-500' : 'text-red-500'" x-text="wasmStatus.features?.basic ? 'Yes' : 'No'"></span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-gray-500 dark:text-gray-400">SIMD</span>
                <span :class="wasmStatus.features?.simd ? 'text-green-500' : 'text-gray-400'" x-text="wasmStatus.features?.simd ? 'Yes' : 'No'"></span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-gray-500 dark:text-gray-400">Threads</span>
                <span :class="wasmStatus.features?.threads ? 'text-green-500' : 'text-gray-400'" x-text="wasmStatus.features?.threads ? 'Yes' : 'No'"></span>
              </div>
              <div x-show="wasmStatus.reason" class="text-red-500 dark:text-red-400 mt-1 break-words">
                <span x-text="wasmStatus.reason"></span>
              </div>
            </div>
          </details>
          <!-- WASM Memory (collapsed) -->
          <details class="mt-2 text-xs">
            <summary class="cursor-pointer text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200">
              WASM Memory
            </summary>
            <div class="mt-1 space-y-1 pl-2" x-data="{ memStats: window.beadsViewer?.getWasmMemoryStats?.() || {} }" x-init="setInterval(() => memStats = window.beadsViewer?.getWasmMemoryStats?.() || {}, 5000)">
              <div class="flex items-center justify-between">
                <span class="text-gray-500 dark:text-gray-400">Tracked</span>
                <span class="text-gray-300" x-text="memStats.tracked || 0"></span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-gray-500 dark:text-gray-400">Freed</span>
                <span class="text-gray-300" x-text="memStats.freed || 0"></span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-gray-500 dark:text-gray-400">Pending</span>
                <span class="text-gray-300" x-text="memStats.pendingSubgraphs || 0"></span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-gray-500 dark:text-gray-400">Leak Est.</span>
                <span :class="(memStats.leakEstimate || 0) > 0 ? 'text-yellow-500' : 'text-green-500'" x-text="memStats.leakEstimate || 0"></span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-gray-500 dark:text-gray-400">Graph Active</span>
                <span :class="memStats.graphActive ? 'text-green-500' : 'text-gray-400'" x-text="memStats.graphActive ? 'Yes' : 'No'"></span>
              </div>
            </div>
          </details>
        </div>

        <!-- Database Info -->
        <div>
          <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">Database</h3>
          <div class="space-y-2">
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-600 dark:text-gray-400">Source</span>
              <span class="text-gray-900 dark:text-gray-100 font-mono text-xs" x-text="diagnostics.dbSource"></span>
            </div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-600 dark:text-gray-400">Size</span>
              <span class="text-gray-900 dark:text-gray-100" x-text="(diagnostics.dbSizeBytes / 1024).toFixed(1) + ' KB'"></span>
            </div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-600 dark:text-gray-400">Issues</span>
              <span class="text-gray-900 dark:text-gray-100" x-text="diagnostics.issueCount"></span>
            </div>
          </div>
        </div>

        <!-- Performance -->
        <div>
          <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">Performance</h3>
          <div class="space-y-2">
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-600 dark:text-gray-400">Load Time</span>
              <span class="text-gray-900 dark:text-gray-100" x-text="diagnostics.loadTimeMs + ' ms'"></span>
            </div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-600 dark:text-gray-400">Queries Run</span>
              <span class="text-gray-900 dark:text-gray-100" x-text="diagnostics.queryCount"></span>
            </div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-600 dark:text-gray-400">Query Errors</span>
              <span :class="diagnostics.queryErrors > 0 ? 'text-red-500' : 'text-green-500'" x-text="diagnostics.queryErrors"></span>
            </div>
          </div>
        </div>

        <!-- Error Log -->
        <div x-show="diagnostics.queryErrors > 0 || (window.beadsViewer?.ERROR_STATE?.errors?.length > 0)">
          <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">Recent Errors</h3>
          <div class="space-y-2 max-h-48 overflow-y-auto">
            <template x-for="err in (window.beadsViewer?.ERROR_STATE?.errors || []).slice(-5)" :key="err.id">
              <div class="p-2 bg-red-50 dark:bg-red-900/20 rounded text-xs">
                <div class="font-medium text-red-700 dark:text-red-300" x-text="err.title"></div>
                <div class="text-red-600 dark:text-red-400 truncate" x-text="err.message"></div>
              </div>
            </template>
          </div>
        </div>

        <!-- Keyboard Shortcuts -->
        <div>
          <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">Shortcuts</h3>
          <div class="text-xs text-gray-600 dark:text-gray-400 space-y-1">
            <div><kbd class="px-1.5 py-0.5 bg-gray-100 dark:bg-gray-700 rounded">?</kbd> Full help</div>
            <div><kbd class="px-1.5 py-0.5 bg-gray-100 dark:bg-gray-700 rounded">/</kbd> Search</div>
            <div><kbd class="px-1.5 py-0.5 bg-gray-100 dark:bg-gray-700 rounded">d</kbd> Diagnostics</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Keyboard Help Modal (press '?' to open) -->
    <div x-show="showKeyboardHelp"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-150"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-[60] overflow-y-auto"
         @keydown.escape.window="showKeyboardHelp = false">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black/50" @click="showKeyboardHelp = false"></div>
        <div class="relative bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-lg w-full">
          <div class="p-6">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-xl font-semibold text-gray-900 dark:text-gray-100">Keyboard Shortcuts</h2>
              <button @click="showKeyboardHelp = false" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
              </button>
            </div>

            <div class="space-y-6">
              <!-- Global Shortcuts -->
              <div>
                <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Global</h3>
                <div class="grid grid-cols-2 gap-2 text-sm">
                  <div class="flex items-center space-x-2">
                    <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">/</kbd>
                    <span class="text-gray-600 dark:text-gray-400">Focus search</span>
                  </div>
                  <div class="flex items-center space-x-2">
                    <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">?</kbd>
                    <span class="text-gray-600 dark:text-gray-400">This help</span>
                  </div>
                  <div class="flex items-center space-x-2">
                    <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">d</kbd>
                    <span class="text-gray-600 dark:text-gray-400">Diagnostics</span>
                  </div>
                  <div class="flex items-center space-x-2">
                    <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">c</kbd>
                    <span class="text-gray-600 dark:text-gray-400">Critical path</span>
                  </div>
                  <div class="flex items-center space-x-2">
                    <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Esc</kbd>
                    <span class="text-gray-600 dark:text-gray-400">Close modal</span>
                  </div>
                </div>
              </div>

              <!-- Issue Navigation -->
              <div>
                <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Issue Detail</h3>
                <div class="grid grid-cols-2 gap-2 text-sm">
                  <div class="flex items-center space-x-2">
                    <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">j</kbd>
                    <span class="text-gray-600 dark:text-gray-400">Next issue</span>
                  </div>
                  <div class="flex items-center space-x-2">
                    <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">k</kbd>
                    <span class="text-gray-600 dark:text-gray-400">Previous issue</span>
                  </div>
                  <div class="flex items-center space-x-2">
                    <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">h</kbd>
                    <span class="text-gray-600 dark:text-gray-400">Go to blocker</span>
                  </div>
                  <div class="flex items-center space-x-2">
                    <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">l</kbd>
                    <span class="text-gray-600 dark:text-gray-400">Go to dependent</span>
                  </div>
                  <div class="flex items-center space-x-2">
                    <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">g</kbd>
                    <span class="text-gray-600 dark:text-gray-400">Toggle graph</span>
                  </div>
                </div>
              </div>

              <!-- Issue List -->
              <div>
                <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Issue List</h3>
                <div class="grid grid-cols-2 gap-2 text-sm">
                  <div class="flex items-center space-x-2">
                    <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">o</kbd>
                    <span class="text-gray-600 dark:text-gray-400">Open first issue</span>
                  </div>
                </div>
              </div>

              <!-- Tips -->
              <div class="pt-4 border-t border-gray-200 dark:border-gray-700">
                <p class="text-xs text-gray-500 dark:text-gray-400">
                  <strong>Tip:</strong> Use <kbd class="px-1 py-0.5 bg-gray-100 dark:bg-gray-700 rounded text-xs">h</kbd> and <kbd class="px-1 py-0.5 bg-gray-100 dark:bg-gray-700 rounded text-xs">l</kbd> to traverse the dependency chain. Navigate "left" to blockers and "right" to dependents.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Database source indicator -->
    <div class="fixed bottom-4 right-4 px-3 py-1 bg-gray-800/80 text-gray-200 text-xs rounded-full">
      <span x-text="'DB: ' + dbSource"></span>
      <span x-show="meta.issue_count" x-text="' | ' + meta.issue_count + ' issues'"></span>
    </div>
  </div>

  <!-- Alpine.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

  <!-- DOMPurify for safe HTML rendering -->
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>

  <!-- Marked.js for markdown -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- Mermaid.js for dependency graphs -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>
    // Initialize Mermaid with theme based on dark mode state
    // Uses Dracula-inspired colors for dark mode, GitHub-inspired for light mode
    function getMermaidConfig() {
      const dark = document.documentElement.classList.contains('dark');
      return {
        startOnLoad: false,
        theme: dark ? 'dark' : 'neutral',
        flowchart: { curve: 'basis', padding: 10 },
        securityLevel: 'strict',
        themeVariables: dark ? {
          // Dracula-inspired dark theme
          primaryColor: '#bd93f9',      // Purple
          primaryTextColor: '#f8f8f2',  // Foreground
          primaryBorderColor: '#ff79c6', // Pink
          lineColor: '#6272a4',         // Muted (comment)
          secondaryColor: '#44475a',    // Background secondary
          tertiaryColor: '#282a36',     // Background
          background: '#282a36',
          mainBkg: '#282a36',
          nodeBorder: '#bd93f9',
          clusterBkg: '#44475a',
          clusterBorder: '#6272a4',
          titleColor: '#f8f8f2',
          edgeLabelBackground: '#44475a',
          nodeTextColor: '#f8f8f2'
        } : {
          // GitHub-inspired light theme
          primaryColor: '#8250df',      // Purple
          primaryTextColor: '#24292f',  // Foreground
          primaryBorderColor: '#bf3989', // Pink
          lineColor: '#57606a',         // Muted
          secondaryColor: '#f6f8fa',    // Background secondary
          tertiaryColor: '#ffffff',     // Background
          background: '#ffffff',
          mainBkg: '#ffffff',
          nodeBorder: '#8250df',
          clusterBkg: '#f6f8fa',
          clusterBorder: '#d0d7de',
          titleColor: '#24292f',
          edgeLabelBackground: '#f6f8fa',
          nodeTextColor: '#24292f'
        }
      };
    }
    mermaid.initialize(getMermaidConfig());

    // Expose for theme toggle re-initialization
    window.reinitializeMermaid = function() {
      mermaid.initialize(getMermaidConfig());
    };
  </script>

  <!-- Force-Graph dependencies (Graph view) -->
  <script src="https://unpkg.com/force-graph@1.43.5/dist/force-graph.min.js"></script>
  <script src="https://d3js.org/d3.v7.min.js" crossorigin="anonymous"></script>

  <!-- Chart.js for interactive charts (bv-wb6h) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <!-- Charts module -->
  <script src="charts.js"></script>

  <!-- Viewer application -->
  <script src="viewer.js"></script>
</body>
</html>
